<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate isoform-specific fraction news (or more generally "fractions"). — EstimateIsoformFractions • EZbakR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate isoform-specific fraction news (or more generally " fractions estimateisoformfractions><meta name="description" content="Combines the output of EstimateFractions with transcript isoform
quantification performed by an outside tool (e.g., RSEM, kallisto, salmon, etc.)
to infer transcript isoform-specific fraction news (or more generally fraction
of reads coming from a particular mutation population)."><meta property="og:description" content="Combines the output of EstimateFractions with transcript isoform
quantification performed by an outside tool (e.g., RSEM, kallisto, salmon, etc.)
to infer transcript isoform-specific fraction news (or more generally fraction
of reads coming from a particular mutation population)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EZbakR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Quickstart.html">EZbakR for people in a hurry</a></li>
    <li><a class="dropdown-item" href="../articles/EZget.html">Convenient fetching of EZbakR outputs: EZget()</a></li>
    <li><a class="dropdown-item" href="../articles/EstimateFractions.html">Universal first step: EstimateFractions()</a></li>
    <li><a class="dropdown-item" href="../articles/EstimateKinetics.html">Standard kinetic parameter estimation: EstimateKinetics()</a></li>
    <li><a class="dropdown-item" href="../articles/Linear-modeling.html">Linear modeling in EZbakR</a></li>
    <li><a class="dropdown-item" href="../articles/EZDynamics.html">Dynamical systems modeling in EZbakR: EZDynamics()</a></li>
    <li><a class="dropdown-item" href="../articles/EZQC.html">QCing your NR-seq data with EZbakR: EZQC()</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/isaacvock/EZbakR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate isoform-specific fraction news (or more generally "fractions").</h1>
      <small class="dont-index">Source: <a href="https://github.com/isaacvock/EZbakR/blob/main/R/Isoforms.R" class="external-link"><code>R/Isoforms.R</code></a></small>
      <div class="d-none name"><code>EstimateIsoformFractions.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Combines the output of <code>EstimateFractions</code> with transcript isoform
quantification performed by an outside tool (e.g., RSEM, kallisto, salmon, etc.)
to infer transcript isoform-specific fraction news (or more generally fraction
of reads coming from a particular mutation population).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">EstimateIsoformFractions</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  features <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  populations <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fraction_design <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  repeatID <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  exactMatch <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fraction_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quant_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gene_to_transcript <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  TPM_min <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  count_min <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obj">obj<a class="anchor" aria-label="anchor" href="#arg-obj"></a></dt>
<dd><p>An <code>EZbakRData</code> object</p></dd>


<dt id="arg-features">features<a class="anchor" aria-label="anchor" href="#arg-features"></a></dt>
<dd><p>Character vector of the set of features you want to stratify
reads by and estimate proportions of each RNA population. The default of "all"
will use all feature columns in the <code>obj</code>'s cB.</p></dd>


<dt id="arg-populations">populations<a class="anchor" aria-label="anchor" href="#arg-populations"></a></dt>
<dd><p>Mutational populations that were analyzed to generate the
fractions table to use. For example, this would be "TC" for a standard
s4U-based nucleotide recoding experiment.</p></dd>


<dt id="arg-fraction-design">fraction_design<a class="anchor" aria-label="anchor" href="#arg-fraction-design"></a></dt>
<dd><p>"Design matrix" specifying which RNA populations exist
in your samples. By default, this will be created automatically and will assume
that all combinations of the <code>mutrate_populations</code> you have requested to analyze are
present in your data. If this is not the case for your data, then you will have
to create one manually. See docs for <code>EstimateFractions</code> (run ?EstimateFractions()) for more details.</p></dd>


<dt id="arg-repeatid">repeatID<a class="anchor" aria-label="anchor" href="#arg-repeatid"></a></dt>
<dd><p>If multiple <code>fractions</code> tables exist with the same metadata,
then this is the numerical index by which they are distinguished.</p></dd>


<dt id="arg-exactmatch">exactMatch<a class="anchor" aria-label="anchor" href="#arg-exactmatch"></a></dt>
<dd><p>If TRUE, then <code>features</code> and <code>populations</code> have to exactly match
those for a given fractions table for that table to be used. Means that you can't
specify a subset of features or populations by default, since this is TRUE
by default.</p></dd>


<dt id="arg-fraction-name">fraction_name<a class="anchor" aria-label="anchor" href="#arg-fraction-name"></a></dt>
<dd><p>Name of fraction estimate table to use. Should be stored in the
<code>obj$fractions</code> list under this name. Can also rely on specifying <code>features</code> and/or <code>populations</code>
and having <code><a href="EZget.html">EZget()</a></code> find it.</p></dd>


<dt id="arg-quant-name">quant_name<a class="anchor" aria-label="anchor" href="#arg-quant-name"></a></dt>
<dd><p>Name of transcript isoform quantification table to use. Should be stored
in the obj$readcounts list under this name. Use <code><a href="ImportIsoformQuant.html">ImportIsoformQuant()</a></code> to create
this table. If <code>quant_name</code> is <code>NULL</code>, it will search for tables containing the string
"isoform_quant" in their name, as that is the naming convention used by <code><a href="ImportIsoformQuant.html">ImportIsoformQuant()</a></code>.
If more than one such table exists, an error will be thrown and you will have to specify
the exact name in <code>quant_name</code>.</p></dd>


<dt id="arg-gene-to-transcript">gene_to_transcript<a class="anchor" aria-label="anchor" href="#arg-gene-to-transcript"></a></dt>
<dd><p>Table with columns <code>transcript_id</code> and all feature related
columns that appear in the relevant fractions table. This is only relevant as a hack to
to deal with the case where STAR includes in its transcriptome alignment transcripts
on the opposite strand from where the RNA actually originated. This table will be used
to filter out such transcript-feature combinations that should not exist.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>If TRUE and a fractions estimate output already exists that
would possess the same metadata (features analyzed, populations analyzed,
and fraction_design), then it will get overwritten with the new output. Else,
it will be saved as a separate output with the same name + "_#" where "#" is a
numerical ID to distinguish the similar outputs.</p></dd>


<dt id="arg-tpm-min">TPM_min<a class="anchor" aria-label="anchor" href="#arg-tpm-min"></a></dt>
<dd><p>Minimum TPM for a transcript to be kept in analysis.</p></dd>


<dt id="arg-count-min">count_min<a class="anchor" aria-label="anchor" href="#arg-count-min"></a></dt>
<dd><p>Minimum expected_count for a transcript to be kept in analysis.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>EZbakRData</code> object with an additional table under the "fractions"
list. Has the same form as the output of <code><a href="EstimateFractions.html">EstimateFractions()</a></code>, and will have the
feature column "transcript_id".</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>EstimateIsoformFractions</code> expects as input a "fractions" table with estimates
for transcript equivalence class (TEC) fraction news. A transcript equivalence class
is the set of transcript isoforms with which a sequencing read is compatible.
<a href="https://github.com/isaacvock/fastq2EZbakR" class="external-link">fastq2EZbakR</a> is able to assign
reads to these equivalence classes so that EZbakR can estimate the fraction of
reads in each TEC that are from labeled RNA.</p>
<p><code>EstimateIsoformFractions</code> estimates transcript isoform fraction news
by fitting a linear mixing model to the TEC fraction new estimates + transcript
isoform abundance estimates. In other words, each TEC fraction new (data) is modeled
as a weighted average of transcript isoform fraction news (parameters to estimate),
with the weights determined by the relative abundances of the transcript isoforms
in the TEC (data). The TEC fraction new is modeled as a Beta distribution with mean
equal to the weighted transcript isoform fraction new average and variance related
to the number of reads in the TEC.</p>
<p>Transcript isoforms with estimated TPMs less than with an estimated
TPM greater than <code>TPM_min</code> (1 by default) or an estimated number of read
counts less than <code>count_min</code> (10 by default) are removed from TECs and will
not have their fraction news estimated.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load dependencies</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulates a single sample worth of data</span></span></span>
<span class="r-in"><span><span class="va">simdata_iso</span> <span class="op">&lt;-</span> <span class="fu"><a href="SimulateIsoforms.html">SimulateIsoforms</a></span><span class="op">(</span>nfeatures <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We have to manually create the metadf in this case</span></span></span>
<span class="r-in"><span><span class="va">metadf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="st">'sampleA'</span>,</span></span>
<span class="r-in"><span>                     tl <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                     condition <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ezbdo</span> <span class="op">&lt;-</span> <span class="fu"><a href="EZbakRData.html">EZbakRData</a></span><span class="op">(</span><span class="va">simdata_iso</span><span class="op">$</span><span class="va">cB</span>,</span></span>
<span class="r-in"><span>                    <span class="va">metadf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ezbdo</span> <span class="op">&lt;-</span> <span class="fu"><a href="EstimateFractions.html">EstimateFractions</a></span><span class="op">(</span><span class="va">ezbdo</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating mutation rates</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Summarizing data for feature(s) of interest</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Averaging out the nucleotide counts for improved efficiency</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimating fractions</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing output</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Hack in the true, simulated isoform levels</span></span></span>
<span class="r-in"><span><span class="va">reads</span> <span class="op">&lt;-</span> <span class="va">simdata_iso</span><span class="op">$</span><span class="va">ground_truth</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">transcript_id</span>, <span class="va">true_count</span>, <span class="va">true_TPM</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="st">'sampleA'</span>,</span></span>
<span class="r-in"><span>                effective_length <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>expected_count <span class="op">=</span> <span class="va">true_count</span>,</span></span>
<span class="r-in"><span>                TPM <span class="op">=</span> <span class="va">true_TPM</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Name of table needs to have "isoform_quant" in it</span></span></span>
<span class="r-in"><span><span class="va">ezbdo</span><span class="op">[[</span><span class="st">'readcounts'</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">'simulated_isoform_quant'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">reads</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Perform deconvolution</span></span></span>
<span class="r-in"><span><span class="va">ezbdo</span> <span class="op">&lt;-</span> <span class="fu">EstimateIsoformFractions</span><span class="op">(</span><span class="va">ezbdo</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Analyzing sample sampleA...</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Isaac Vock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

