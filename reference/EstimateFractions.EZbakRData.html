<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate fractions of each RNA population with standard EZbakRData object — EstimateFractions.EZbakRData • EZbakR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate fractions of each RNA population with standard EZbakRData object — EstimateFractions.EZbakRData"><meta name="description" content="This is the default fraction estimation strategy for EZbakR. cB is assumed to
be an in-memory table and obj is expected to be an EZbakRData object
created with EZbakRData(). For larger than RAM cB files, see the relevant
EZbakRArrowData method."><meta property="og:description" content="This is the default fraction estimation strategy for EZbakR. cB is assumed to
be an in-memory table and obj is expected to be an EZbakRData object
created with EZbakRData(). For larger than RAM cB files, see the relevant
EZbakRArrowData method."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EZbakR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Quickstart.html">EZbakR for people in a hurry</a></li>
    <li><a class="dropdown-item" href="../articles/EZget.html">EZget</a></li>
    <li><a class="dropdown-item" href="../articles/EstimateFractions.html">EstimateFractions</a></li>
    <li><a class="dropdown-item" href="../articles/EstimateKinetics.html">EstimateKinetics</a></li>
    <li><a class="dropdown-item" href="../articles/Linear-modeling.html">Linear modeling in EZbakR</a></li>
    <li><a class="dropdown-item" href="../articles/EZDynamics.html">Dynamical systems modeling in EZbakR</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate fractions of each RNA population with standard EZbakRData object</h1>

      <div class="d-none name"><code>EstimateFractions.EZbakRData.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is the default fraction estimation strategy for EZbakR. cB is assumed to
be an in-memory table and <code>obj</code> is expected to be an <code>EZbakRData</code> object
created with <code><a href="EZbakRData.html">EZbakRData()</a></code>. For larger than RAM cB files, see the relevant
<code>EZbakRArrowData</code> method.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'EZbakRData'</span></span>
<span><span class="fu"><a href="EstimateFractions.html">EstimateFractions</a></span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  features <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  mutrate_populations <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  fraction_design <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Poisson <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"standard"</span>, <span class="st">"hierarchical"</span><span class="op">)</span>,</span>
<span>  filter_cols <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  filter_condition <span class="op">=</span> <span class="va">`&amp;`</span>,</span>
<span>  remove_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="st">"__no_feature"</span><span class="op">)</span>,</span>
<span>  split_multi_features <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  multi_feature_cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  multi_feature_sep <span class="op">=</span> <span class="st">"+"</span>,</span>
<span>  pnew_prior_mean <span class="op">=</span> <span class="op">-</span><span class="fl">2.94</span>,</span>
<span>  pnew_prior_sd <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  pold_prior_mean <span class="op">=</span> <span class="op">-</span><span class="fl">6.5</span>,</span>
<span>  pold_prior_sd <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  hier_readcutoff <span class="op">=</span> <span class="fl">300</span>,</span>
<span>  init_pnew_prior_sd <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  pnew_prior_sd_min <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  pnew_prior_sd_max <span class="op">=</span> <span class="fl">0.15</span>,</span>
<span>  pold_est <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pold_from_nolabel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  grouping_factors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  character_limit <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obj">obj<a class="anchor" aria-label="anchor" href="#arg-obj"></a></dt>
<dd><p><code>EZbakRData</code> object</p></dd>


<dt id="arg-features">features<a class="anchor" aria-label="anchor" href="#arg-features"></a></dt>
<dd><p>Character vector of the set of features you want to stratify
reads by and estimate proportions of each RNA population. The default of "all"
will use all feature columns in the <code>obj</code>'s cB file.</p></dd>


<dt id="arg-mutrate-populations">mutrate_populations<a class="anchor" aria-label="anchor" href="#arg-mutrate-populations"></a></dt>
<dd><p>Character vector of the set of mutational populations
that you want to infer the rates of mutations for. By default, all mutation rates
are estimated for all populations present in cB.</p></dd>


<dt id="arg-fraction-design">fraction_design<a class="anchor" aria-label="anchor" href="#arg-fraction-design"></a></dt>
<dd><p>"Design matrix" specifying which RNA populations exist
in your samples. By default, this will be created automatically and will assume
that all combinations of the <code>mutrate_populations</code> you have requested to analyze are
present in your data. If this is not the case for your data, then you will have
to create one manually.</p>
<p>If you call the function <code>create_fraction_design(...)</code>, providing a vector
of mutational population names as input, it will create a <code>fraction_design</code> table for
you, with the assumption that every single possible combination of mutational populations
is present in your data. You can then edit the <code>present</code> column as necessary to
get an appropriate <code>fraction_design</code> for your use case. See below for details on
the required contents of <code>fraction_design</code> and its interpretation.</p>
<p><code>fraction_design</code> must have one column per element of <code>mutrate_populations</code>,
with these columns sharing the name of the <code>mutrate_populations</code>. It must also have
one additional column named <code>present</code>. All elements of fraction_design should be
booleans (<code>TRUE</code> or <code>FALSE</code>). It should include all possible combinations of <code>TRUE</code>
and <code>FALSE</code> for the <code>mutrate_populations</code> columns. A <code>TRUE</code> in one of these columns
represents a population of RNA that is expected to have above background mutation
rates of that type. <code>present</code> will denote whether or not that population of RNA
is expected to exist in your data.</p>
<p>For example, assume you are doing a typical TimeLapse-seq/SLAM-seq/TUC-seq/etc. experiment
where you have fed cells with s^4U and recoded any incorporated s^4U to a nucleotide
that reverse transcriptase will read as a cytosine. That means that <code>mutrate_populations</code>
will be "TC", since you want to estimate the fraction of RNA that was s^4U labeled, i.e.,
the fraction with high T-to-C mutation content. <code>fraction_design</code> will thus have two columns:
<code>TC</code> and <code>present</code>. It will also have two rows. One of these rows must have a value of
<code>TRUE</code> for <code>TC</code>, and the other must have a value of <code>FALSE</code>. The row with a value of <code>TRUE</code>
for <code>TC</code> represents the population of reads with high T-to-C mutation content,
i.e., the reads from RNA that were synthesized while s^4U was present. The row
with a value of <code>FALSE</code> for <code>TC</code> reprsents the population of reads with low T-to-C mutation
content, i.e., the reads from RNA that existed prior to s^4U labeling. Both of these
populations exist in your data, so the value of the <code>present</code> column should be <code>TRUE</code> for
both of these. See the lazily loaded <code>standard_fraction_design</code> object for an example
of what this tibble could look like. ("lazily loaded <code>standard_fraction_design</code> object"
means that if you run <code>print(standard_fraction_design)</code> after loading <code>EZbakR</code> with <code><a href="https://isaacvock.github.io/EZbakR/">library(EZbakR)</a></code>,
then you can see its contents. More specifically, lazily loaded means that this table is not loaded
into memory until you ask for it, via something like a <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> call.)</p>
<p>As another example, consider TILAC, a NR-seq extension developed by the Simon lab. TILAC was originally
described in <a href="https://academic.oup.com/nar/article/50/19/e110/6677324" class="external-link">Courvan et al., 2022</a>. In this
method, two populations of RNA, one from s^4U fed cells and one from s^6G fed cells, are pooled
and prepped for sequencing together. This allows for internally controlled comparisons of RNA
abundance without spike-ins. s^4U is recoded to a cytosine analog by TimeLapse chemistry
(or similar chemistry) and s^6G is recoded to an adenine analog. Thus, <code>fraction_design</code> includes
columns called <code>TC</code> and <code>GA</code>. A unique aspect of the TILAC <code>fraction_design</code> table is that
one of the possible populations, <code>TC</code> and <code>GA</code> both <code>TRUE</code>, is denoted as not present (<code>present</code> = <code>FALSE</code>).
This is because there is no RNA that was exposed to both s^4U and s^6G, thus a population of reads
with both high T-to-C and G-to-A mutational content should not exist. To see an example
of what a TILAC <code>fraction_design</code> table could look like, see the lazily loaded
<code>tilac_fraction_design</code> object.</p></dd>


<dt id="arg-poisson">Poisson<a class="anchor" aria-label="anchor" href="#arg-poisson"></a></dt>
<dd><p>If <code>TRUE</code>, use U-content adjusted Poisson mixture modeling strategy. Often provides
significant speed gain without sacrificing accuracy.</p></dd>


<dt id="arg-strategy">strategy<a class="anchor" aria-label="anchor" href="#arg-strategy"></a></dt>
<dd><p>String denoting which new read mutation rate estimation strategy to use.
Options include:</p><ul><li><p>standard: Estimate a single new read and old read mutation rate for each
sample. This is done via a binomial mixture model aggregating over</p></li>
<li><p>hierarchical: Estimate feature-specific new read mutation
rate, regularizing the feature-specific estimate with a sample-wide prior. Currently
only compatible with single mutation type mixture modeling.</p></li>
</ul></dd>


<dt id="arg-filter-cols">filter_cols<a class="anchor" aria-label="anchor" href="#arg-filter-cols"></a></dt>
<dd><p>Which feature columns should be used to filter out feature-less
reads. The default value of "all" checks all feature columns for whether or not a
read failed to get assigned to said feature.</p></dd>


<dt id="arg-filter-condition">filter_condition<a class="anchor" aria-label="anchor" href="#arg-filter-condition"></a></dt>
<dd><p>Only two possible values for this make sense: <code>`&amp;`</code> and <code>`|`</code>.
If set to <code>`&amp;`</code>, then all features in <code>filter_cols</code> must have a "null" value (i.e., a value included
in <code>remove_features</code>) for the row to get filtered out. If set to <code>`|`</code>, then only
a single feature in <code>filter_cols</code> needs to have one of these "null" values to get filtered out.</p></dd>


<dt id="arg-remove-features">remove_features<a class="anchor" aria-label="anchor" href="#arg-remove-features"></a></dt>
<dd><p>All of the feature names that could indicate failed assignment of a read
to a given feature. the fastq2EZbakR pipeline uses a value of '__no_feature'.</p></dd>


<dt id="arg-split-multi-features">split_multi_features<a class="anchor" aria-label="anchor" href="#arg-split-multi-features"></a></dt>
<dd><p>If a set of reads maps ambiguously to multiple features,
should data for such reads be copied for each feature in the ambiguous set? If this is
<code>TRUE</code>, then <code>multi_feature_cols</code> also must be set. Examples where this should be set
to <code>TRUE</code> includes when analyzing exonic bins (concept defined in original DEXSeq paper),
exon-exon junctions, etc.</p></dd>


<dt id="arg-multi-feature-cols">multi_feature_cols<a class="anchor" aria-label="anchor" href="#arg-multi-feature-cols"></a></dt>
<dd><p>Character vector of columns that have the potential to
include assignment to multiple features. Only these columns will have their features split
if <code>split_multi_features</code> is <code>TRUE</code>.</p></dd>


<dt id="arg-multi-feature-sep">multi_feature_sep<a class="anchor" aria-label="anchor" href="#arg-multi-feature-sep"></a></dt>
<dd><p>String representing how ambiguous feature assignments are
distinguished in the feature names. For example, the default value of "+" denotes
that if a read maps to multiple features (call them featureA and featureB, for example),
then the feature column will have a value of "featureA+featureB" for that read.</p></dd>


<dt id="arg-pnew-prior-mean">pnew_prior_mean<a class="anchor" aria-label="anchor" href="#arg-pnew-prior-mean"></a></dt>
<dd><p>Mean for logit(pnew) prior.</p></dd>


<dt id="arg-pnew-prior-sd">pnew_prior_sd<a class="anchor" aria-label="anchor" href="#arg-pnew-prior-sd"></a></dt>
<dd><p>Standard deviation for logit(pnew) prior.</p></dd>


<dt id="arg-pold-prior-mean">pold_prior_mean<a class="anchor" aria-label="anchor" href="#arg-pold-prior-mean"></a></dt>
<dd><p>Mean for logit(pold) prior.</p></dd>


<dt id="arg-pold-prior-sd">pold_prior_sd<a class="anchor" aria-label="anchor" href="#arg-pold-prior-sd"></a></dt>
<dd><p>Standard deviation for logit(pold) prior.</p></dd>


<dt id="arg-hier-readcutoff">hier_readcutoff<a class="anchor" aria-label="anchor" href="#arg-hier-readcutoff"></a></dt>
<dd><p>If <code>strategy</code> == <code>hierarchical</code>, only features with this many reads
are used to infer the distribution of feature-specific labeled read mutation rates.</p></dd>


<dt id="arg-init-pnew-prior-sd">init_pnew_prior_sd<a class="anchor" aria-label="anchor" href="#arg-init-pnew-prior-sd"></a></dt>
<dd><p>If <code>strategy</code> == <code>hierarchical</code>, this is the initial logit(pnew)
prior standard deviation to regularize feature-specific labeled read mutation rate estimates.</p></dd>


<dt id="arg-pnew-prior-sd-min">pnew_prior_sd_min<a class="anchor" aria-label="anchor" href="#arg-pnew-prior-sd-min"></a></dt>
<dd><p>The minimum logit(pnew) prior standard deviation when <code>strategy</code>
is set to "hierarchcial". EZbakR will try to estimate this empirically as the standard deviation
of initial feature-specific logit(pnew) estimates using high coverage features, minus the
average uncertainty in the logit(pnew) estimates. As this difference can sometimes be negative,
a value of <code>pnew_prior_sd_min</code> will be imputed in that case.</p></dd>


<dt id="arg-pnew-prior-sd-max">pnew_prior_sd_max<a class="anchor" aria-label="anchor" href="#arg-pnew-prior-sd-max"></a></dt>
<dd><p>Similar to <code>pnew_prior_sd_min</code>, but now representing the
maximum allowed logit(pnew) prior sd.</p></dd>


<dt id="arg-pold-est">pold_est<a class="anchor" aria-label="anchor" href="#arg-pold-est"></a></dt>
<dd><p>Background mutation rate estimates if you have them. Can either be a single
number applied to all samples or a named vector of values, where the names should be sample
names.</p></dd>


<dt id="arg-pold-from-nolabel">pold_from_nolabel<a class="anchor" aria-label="anchor" href="#arg-pold-from-nolabel"></a></dt>
<dd><p>Fix background mutation rate estimate to mutation rates seen in -label samples.
By default, a single background rate is used for all samples, inferred from the average mutation rate
across all -label samples. The <code>grouping_factors</code> argument can be specified to use certain -label samples
to infer background mutation rates for certain sets of +label samples.</p></dd>


<dt id="arg-grouping-factors">grouping_factors<a class="anchor" aria-label="anchor" href="#arg-grouping-factors"></a></dt>
<dd><p>If <code>pold_from_nolabel</code> is TRUE, then <code>grouping_factors</code> will specify the
sample-detail columns in the metadf that should be used to group -label samples by. Average mutation
rates in each group of -label samples will be used as the background mutation rate estimate in
+label samples with the same values for the relevant metadf columns.</p></dd>


<dt id="arg-character-limit">character_limit<a class="anchor" aria-label="anchor" href="#arg-character-limit"></a></dt>
<dd><p>Maximum number of characters for naming out fractions output. EZbakR
will try to name this as a "_" separated character vector of all of the features analyzed.
If this name is greater than <code>character_limit</code>, then it will default to "fraction#", where
"#" represents a simple numerical ID for the table.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>If TRUE and a fractions estimate output already exists that
would possess the same metadata (features analyzed, populations analyzed,
and fraction_design), then it will get overwritten with the new output. Else,
it will be saved as a separate output with the same name + "_#" where "#" is a
numerical ID to distinguish the similar outputs.</p></dd>

</dl></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Isaac Vock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

